%VERSION of May 13, 2010,by phD Zhijun Zhang and MS Jun Lee
clc;

format long;
global alpha r q0 T lambda sigma aa alpha_i a_i d_i D sa ca s2a c2a pen_long k tt errorr K; 

%circle data
T=8.0;             %????????????
r=0.8;
alpha=pi/6;
sigma=pi/1;
aa=0.08; 
tt=0; errorr=0;

%%%p560 kenimatic data: with a long tool
%a2=0.0;a3=0.0;d3=0.0;d4=0.0;d6=0.0;        %P560????????

%Jaco??????????????
%????????
% D = [0.2755, 0.4100, 0.2073, 0.07433, 0.07433, 0.1687, 0.0098]; %D1~D6;E2
%????????
% D = [0.2755, 0.4100, 0.2073, 0.07433, 0.07433, 0.13, 0.0098]; %D1~D6;E2
D= [0.2755, 0.4100, 0.2073, 0.0741, 0.0741, 0.1425, 0.0098];
pen_long=0.075;                                 %????
aaa = 12.0*pi/72;
ca = cos(aaa);
sa = sin(aaa);
c2a = cos(2*aaa);
s2a = sin(2*aaa);
d4b = D(3)+sa/s2a*D(4);
d5b = sa/s2a*D(4)+sa/s2a*D(5);
d6b = sa/s2a*D(5)+D(6);
alpha_i = [pi/2, pi, pi/2, 2*aaa, 2*aaa, pi];
a_i = [0, D(2), 0, 0, 0, 0];
d_i = [D(1), 0, -D(7), -d4b, -d5b, -d6b];

%selection of an initial state q0
qa=[0;0;0;0;0;0];                                           %????????????????
qb=[0;-pi/4;0;pi/2;-pi/4;0];
qc=[0;+pi/4;0;pi/2;-pi/4;0];
qd=[0;-pi/4;0;2*pi/3;-pi/4;0];
qe=[0;+pi/4;0;2*pi/3;-pi/4;0];
qf=[0;-pi/4;0;pi/2;-pi/4;0];
qg=[0;-pi/4;0;pi/2;-pi/4;0];

qh=[1.675;1.343;-3.716;4.187;-1.71;1.308];          %jaco??????????????
qi=[1.675;2.843;-3.216;4.187;-1.71;-2.29];          %??????????????
qj=[1.675;2.843;-3.216;4.187;-1.71;-2.65];          %????????????????????
q0=qj;%an initial state q0

global mu_p mu_v qP qM qDp qDm qDDp qDDm myInf n m Pinfty Minfty gamma beta Time nu;
n=6;                                    %??????????????6??????
m=3;%??????????????????????????????3??????????
nu=2500;
gamma=500;   
K=1*eye(m,m);
beta=4;%may need adjust
lambda=4;
myInf=1e10;
mu_p=20;
qP=[10000;223;71;10000;10000;10000];    %????????????????
qM=[-10000;-137;-289;-10000;-10000;-10000];      %????????????????
rad=180/pi;                             %????????
qP=qP/rad;                              %????????
qM=qM/rad;                              %????????
qDp=ones(n,1)*1.5;qDm=-qDp;%not real, just a test           %??????????
% qDDp=ones(6,1)*4;qDDm=-qDDp;%not real, just a test
Pinfty=myInf*ones(m,1);
Minfty=-Pinfty;

Time=0;                                 %??????????????????

dq0=zeros(n,1);                             %???????????????????????????? Theta dot
u0=[dq0;zeros(m,1)];                        %????????????????????u
% u0=(rand(n+m,1)-0.5)*10
init=[q0;u0];%acutally, abitrary initial y0
options=odeset('Mass', @mvn_ZNN_matrixALL, 'MaxStep',0.05,'RelTol',1e-6,'AbsTol',1e-8*ones(n+n+m,1));          %????ODE????????????????????????????????????????????????
tic;   %????????
N=1;
[t,y]=ode15s(@mvn_ZZJLJrebi1_net,[0,N*T],init,options);%ode15s much better than ode45            %ODE????
cpu_time=toc                                                        %????????
size(t)
size(y)
%save cpu_time to "txt" file
fid=fopen('mvn_cost_time.txt','a');                                 %????????????????
fprintf(fid,'Computing cost time: %g\n',cpu_time);
fclose(fid);                                                        %????????

%??????????????
save mvn_SYSdata u0 aa beta sigma r alpha lambda alpha_i a_i d_i D sa ca s2a c2a pen_long q0 T mu_p mu_v qP qM qDp qDm qDDp qDDm m Pinfty Minfty gamma n myInf Time k K;
save mvn_INITdata t y;
